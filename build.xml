<?xml version="1.0" encoding="utf-8"?>
<project name="kezdet" default="default" xmlns:antcontrib="antlib:net.sf.antcontrib">
  <property name="working.dir" location="${basedir}" />
  <import file="${working.dir}/build/common.xml" />

  <property name="dont.do.deps" value="true"/>
  <propertyset id="build.properties">
    <propertyref name="working.dir"/>
    <propertyref name="dont.do.deps"/>
  </propertyset>

  <target name="clean-working-dirs" extensionOf="clean-core">
    <delete dir="${build.dir}" failonerror="false"/>
    <delete dir="${log.dir}" failonerror="false"/>
    <delete dir="${dist.dir}" failonerror="false"/>
  </target>
  
  <target name="clean-projects" extensionOf="clean-core">
    <subant target="clean">
      <fileset dir="${basedir}">
        <exclude name="KezdetTestDex/build.xml"/>
        <include name="*/build.xml"/>
      </fileset>
      <propertyset refid="build.properties"/>
    </subant>
  </target>

  <target name="prepare-working-dirs" extensionOf="prepare-core">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${log.dir}"/>
    <mkdir dir="${dist.dir}"/>
  </target>

  <target name="build-core" 
          depends="KezdetInterface,
                   KezdetHostLib,
                   KezdetANEHost,
                   KezdetAIRHost">
  </target>
  
  
  <target name="KezdetInterface">
    <delegatebuild project="KezdetInterface" target="release"/>
  </target>

  <target name="KezdetHostLib" depends="KezdetInterface">
    <delegatebuild project="KezdetHostLib" target="release"/>
  </target>
  
  <target name="KezdetANEHost" depends="KezdetHostLib">
    <delegatebuild project="KezdetANEHost" target="release"/>
  </target>
  
  <target name="KezdetAIRHost">
    <delegatebuild project="KezdetAIRHost" target="build"/>
  </target>
  
  <macrodef name="delegatebuild">
   <attribute name="project"/>
   <attribute name="target" default="build"/>
   <sequential>
      <ant dir="@{project}" target="@{target}" inheritAll="false">
        <propertyset refid="build.properties"/>
      </ant>
   </sequential>
  </macrodef>
  <!-- <target name="KezdetTestDex" depends="KezdetInterface">
    <echo>KezdetTestDex</echo>
  </target>
  
  <target name="KezdetTestHost" depends="KezdetTestDex">
    <echo>KezdetTestHost</echo>
  </target>
  
  <target name="TestKezdetAIRHost" depends="KezdetANEHost,KezdetAIRHost">
    <echo>TestKezdetAIRHost</echo>
  </target> -->

  <import file="${working.dir}/build/build.process.xml" />
</project>